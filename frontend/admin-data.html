<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Admin Data • GSP Events</title>
  <meta name="description" content="Admin portal for managing GSP hosts, venues, and teams." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://app.gspevents.com/assets/styles.css?v=20260110" />
  <link rel="stylesheet" href="https://app.gspevents.com/assets/admin.css?v=20260110" />

  <!-- Load in sequence -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://app.gspevents.com/assets/config.js?v=20260110"></script>
  <script src="https://app.gspevents.com/assets/auth.js?v=20260110"></script>
  <script src="https://app.gspevents.com/assets/main.js?v=20260110"></script>
  <script src="https://app.gspevents.com/assets/admin-data.js?v=20260110"></script>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <img src="https://app.gspevents.com/assets/gsp_logo.png" class="logo" alt="GSP Events" />
      <div class="header-right">Admin Data</div>
    </div>
  </header>

  <main class="container page">
    <section class="card">
      <h1 class="h1" style="margin:0;">Admin Data</h1>
      <div id="globalStatus" class="status" style="display:none;"></div>
      <p class="p">Search and edit Hosts, Venues, and Tournament Teams. Use the forms to create or update entries.</p>
    </section>

    <!-- Weekly Schedule Builder (moved to top) -->
    <section class="card section">
      <h2 class="h2">Weekly Schedule Builder</h2>
      <p class="p">Load active venues, edit their day/time/host for this week's schedule, and generate the text output. Host changes will update the venue's default host.</p>

      <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
        <button id="loadScheduleBtn" class="btn btn-primary">Load Active Venues</button>
        <button id="generateScheduleBtn" class="btn btn-ghost">Generate Schedule Text</button>
        <button id="saveHostChangesBtn" class="btn btn-primary">Save Host Changes</button>
      </div>

      <div id="scheduleBuilderContainer" style="margin-top:8px; overflow:auto; border:1px solid var(--border); padding:10px; border-radius:6px;">
        <div style="color:var(--text-weak);">No data loaded. Click "Load Active Venues" to begin.</div>
      </div>

      <div style="margin-top:8px;">
        <label for="scheduleBuilderOutput">Generated Schedule</label>
        <textarea id="scheduleBuilderOutput" class="input" style="min-height:120px; white-space:pre-wrap;"></textarea>
      </div>
    </section>

    <!-- Cancel Reason Modal (used by Schedule Builder) -->
    <div id="cancelReasonModal" class="modal-backdrop" style="display:none; position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background: rgba(0,0,0,0.45);">
      <div class="modal-content card" style="max-height:90vh; overflow:auto; width:760px;">
        <div class="modal-header">
          <h2 class="h2" id="cancelModalTitle">Cancel Venue</h2>
          <button id="closeCancelModalBtn" class="btn btn-ghost">&times;</button>
        </div>
        <div class="modal-body">
          <div id="cancelModalStatus" class="status" style="display:none;"></div>
          <div class="form-group">
            <label for="cancelReasonText">Reason (optional)</label>
            <textarea id="cancelReasonText" class="input" style="min-height:80px;"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveCancelReasonBtn" class="btn btn-primary">Save</button>
          <button id="clearCancelReasonBtn" class="btn btn-ghost">Clear</button>
        </div>
      </div>
    </div>

    <!-- Weekly Post Report -->
    <section class="card section">
      <h2 class="h2">Weekly Post Report</h2>
      <div class="row row-2">
        <div class="form-group">
          <label for="reportWeekEnding">Week ending (Sunday)</label>
          <input id="reportWeekEnding" class="input" type="date" />
          <div class="help">Pick any date within the week (we'll treat it as the week ending Sunday). If blank, server uses current week in EST.</div>
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <button id="loadWeeklyReportBtn" class="btn btn-primary">Show Report</button>
            <button id="exportWeeklyReportBtn" class="btn btn-ghost">Export CSV</button>
          </div>
        </div>
      </div>

      <div id="weeklyReportContainer" style="margin-top:12px;">
        <!-- Filled by JS -->
      </div>
    </section>

    <!-- Hosts -->
    <section class="card section">
      <h2 class="h2">Hosts</h2>

      <div class="row row-2">
        <div class="form-group">
          <label for="hostSearch">Search Hosts</label>
          <input id="hostSearch" class="input" placeholder="Name or email…" />
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <button id="hostSearchBtn" class="btn btn-primary">Search</button>
        </div>
      </div>

      <ul id="hostsList" class="list"></ul>

      <hr class="sep" style="margin:18px 0; border-color: var(--border);" />

      <h3 class="h2">Add / Edit Host</h3>
      <form id="hostForm">
        <input type="hidden" id="hostId" />
        <div class="row row-2">
          <div class="form-group">
            <label for="hostName">Name</label>
            <input id="hostName" class="input" />
          </div>
          <div class="form-group">
            <label for="hostEmail">Email</label>
            <input id="hostEmail" class="input" type="email" />
          </div>
        </div>
        <div class="row row-2">
          <div class="form-group">
            <label for="hostPhone">Phone</label>
            <input id="hostPhone" class="input" type="tel" />
          </div>
        </div>
        <div style="display:flex; gap:12px; flex-wrap:wrap;">
          <button type="submit" class="btn btn-primary" id="hostSaveBtn">Save Host</button>
          <button type="button" class="btn btn-ghost" id="clearHostFormBtn">Clear</button>
        </div>
        <div id="hostFormStatus" class="status mt-2" style="display:none;"></div>
      </form>
    </section>

    <!-- Venues -->
    <section class="card section">
      <h2 class="h2">Venues</h2>

      <div class="row row-2">
        <div class="form-group">
          <label for="venueSearch">Search Venues</label>
          <input id="venueSearch" class="input" placeholder="Venue name…" />
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <button id="venueSearchBtn" class="btn btn-primary">Search</button>
        </div>
      </div>

      <ul id="venuesList" class="list"></ul>

      <hr class="sep" style="margin:18px 0; border-color: var(--border);" />

      <h3 class="h2">Add / Edit Venue</h3>
      <form id="venueForm">
        <input type="hidden" id="venueId" />
        <div class="row row-2">
          <div class="form-group">
            <label for="venueName">Venue Name</label>
            <input id="venueName" class="input" />
          </div>
          <div class="form-group">
            <label for="defaultDay">Default Day</label>
            <select id="defaultDay" class="input">
              <option value="">—</option>
              <option>Sunday</option><option>Monday</option><option>Tuesday</option>
              <option>Wednesday</option><option>Thursday</option><option>Friday</option><option>Saturday</option>
            </select>
          </div>
        </div>
        <div class="row row-2">
          <div class="form-group">
            <label for="defaultTime">Default Time</label>
            <input id="defaultTime" class="input" placeholder="e.g., 7-9pm" />
          </div>
        <div class="form-group">
            <label class="kv-inline">
              <input type="checkbox" id="venueIsActive" checked>
              Active Venue (Show in reports and lists)
            </label>
        </div>
        <div class="form-group">
          <label for="venueDefaultHost">Default Host</label>
          <select id="venueDefaultHost" class="input">
            <option value="">(no default host)</option>
          </select>
          <div class="help">Optional: preselect a host when creating events for this venue.</div>
        </div>
          <div class="form-group">
            <label>Access Key &nbsp; <button id="regenKeyBtn" type="button" class="btn btn-ghost" style="padding: 2px 8px; font-size: 11px;">Generate New</button></label>
            <input id="accessKey" class="input" readonly placeholder="Key..." style="margin-bottom: 5px;" />
            <div class="help">Used for Venue Owner Portal links. Generate a new key to revoke old access.</div>
          </div>
        </div>

        <!-- Owner link display + copy -->
        <div class="form-group">
          <label for="ownerLink">Owner Portal Link</label>
          <input id="ownerLink" class="input" placeholder="Owner portal URL will appear here" readonly />
          <div class="help">Share with the venue owner. Anyone with the link (key) can view validated stats.</div>
          <div style="margin-top:8px;">
            <button type="button" class="btn btn-ghost" id="copyOwnerLinkBtn">Copy Link</button>
          </div>
        </div>

        <div style="display:flex; gap:12px; flex-wrap:wrap;">
          <button type="submit" class="btn btn-primary" id="venueSaveBtn">Save Venue</button>
          <button type="button" class="btn btn-ghost" id="clearVenueFormBtn">Clear</button>
        </div>
        <div id="venueFormStatus" class="status mt-2" style="display:none;"></div>
      </form>
    </section>

    <!-- Tournament Teams -->
    <section class="card section">
      <h2 class="h2">Tournament Teams</h2>

      <div class="row row-2">
        <div class="form-group">
          <label for="teamSearch">Search Teams</label>
          <input id="teamSearch" class="input" placeholder="Team name or captain email…" />
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <button id="teamSearchBtn" class="btn btn-primary">Search</button>
        </div>
      </div>

      <ul id="teamsList" class="list"></ul>

      <hr class="sep" style="margin:18px 0; border-color: var(--border);" />

      <h3 class="h2">Add / Edit Team</h3>
      <form id="teamForm">
        <input type="hidden" id="teamId" />
        <div class="row row-2">
          <div class="form-group">
            <label for="teamName">Team Name</label>
            <input id="teamName" class="input" />
          </div>
          <div class="form-group">
            <label for="teamHomeVenue">Home Venue</label>
            <select id="teamHomeVenue" class="input"></select>
          </div>
        </div>
        <div class="row row-2">
          <div class="form-group">
            <label for="captainName">Captain Name</label>
            <input id="captainName" class="input" />
          </div>
          <div class="form-group">
            <label for="captainEmail">Captain Email</label>
            <input id="captainEmail" class="input" type="email" />
          </div>
        </div>
        <div class="row row-2">
          <div class="form-group">
            <label for="captainPhone">Captain Phone</label>
            <input id="captainPhone" class="input" type="tel" />
          </div>
          <div class="form-group">
            <label for="playerCount">Player Count</label>
            <input id="playerCount" class="input" type="number" />
          </div>
        </div>
        <div style="display:flex; gap:12px; flex-wrap:wrap;">
          <button type="submit" class="btn btn-primary" id="teamSaveBtn">Save Team</button>
          <button type="button" class="btn btn-ghost" id="clearTeamFormBtn">Clear</button>
          <button type="button" class="btn btn-ghost" id="manageScoresBtn" style="display:none;">Manage Weekly Scores</button>
        </div>
        <div id="teamFormStatus" class="status mt-2" style="display:none;"></div>
      </form>
          <!-- Weekly Scores Modal (hidden by default) -->
      <div id="scoresModal" class="modal-backdrop" style="display:none;">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="h2" id="scoresModalTitle">Manage Weekly Scores</h2>
            <button id="closeScoresModalBtn" class="btn btn-ghost">&times;</button>
          </div>
          <div class="modal-body">
            <div id="scoresModalStatus" class="status" style="display:none;"></div>
            <div class="form-group">
              <label for="scoresVenueSelect">Scores at Venue</label>
              <select id="scoresVenueSelect" class="input"></select>
            </div>
            <div id="weeklyScoresContainer">
              <!-- JS will populate this with 12 weeks of inputs -->
            </div>
          </div>
          <div class="modal-footer">
            <button id="saveScoresModalBtn" class="btn btn-primary">Save Changes</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Bulk Upload -->
    <section class="card section">
      <h2 class="h2">Bulk Upload Historical Events (CSV)</h2>
      <div class="small">Use to backfill a venue’s past nights. Required columns: Date, Host, # of people, # of teams, Comments</div>
      <div id="bulkStatus" class="status" style="display:none;"></div>

      <div class="row row-2" style="margin-top: 8px;">
        <div class="form-group">
          <label for="bulkVenue">Target Venue</label>
          <select id="bulkVenue" class="input"></select>
          <div class="help">All rows will be imported for this venue.</div>
        </div>
        <div class="form-group">
          <label for="bulkFile">CSV File</label>
          <div class="file-field">
            <input id="bulkFile" type="file" accept=".csv,text/csv" class="file-input-hidden" />
            <label for="bulkFile" class="file-btn btn btn-primary">Choose CSV</label>
            <span class="file-name" id="bulkFileName">No file selected</span>
          </div>
          <div class="help">Drag a CSV with headers; comments may be quoted.</div>
        </div>
      </div>

      <div class="row row-2" style="margin-top: 8px;">
        <label class="kv-inline">
          <input type="checkbox" id="bulkValidated" checked />
          Mark events as validated
        </label>
        <label class="kv-inline">
          <input type="checkbox" id="bulkPosted" checked />
          Mark events as posted
        </label>
      </div>

      <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top: 12px;">
        <button id="bulkUploadBtn" class="btn btn-primary">Upload CSV</button>
        <button id="bulkTemplateBtn" class="btn btn-ghost">Download Template</button>
      </div>
    </section>

    <p class="p mt-5 text-center"><a href="/admin.html?v=20260110" class="btn btn-ghost">← Back to Admin</a></p>
  </main>
</body>
</html>